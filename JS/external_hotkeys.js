/*!  CyTube Common Hotkeys
**|  Version 2016.07.06.0239
**|  Written by Xaekai
**|  Copyright 2013-2016
**@preserve
*/
var backspaceKey=false,shiftKey=false,ctrlKey=false,altKey=false,escCode=false;$(document).off("keydown.keytracker keyup.keytracker");$(document).on("keydown.keytracker",function(event){switch(event.which){case 8:backspaceKey=true;return;case 16:shiftKey=true;return;case 17:ctrlKey=true;return;case 18:altKey=true;return}});$(document).on("keyup.keytracker",function(event){escCode=false;switch(event.which){case 8:backspaceKey=false;return;case 16:shiftKey=false;return;case 17:ctrlKey=false;return;case 18:altKey=false;return;case 27:escCode=true;return}});$(document).off("beforeunload.backspacekiller");$(window).on("beforeunload.backspacekiller",function(){if(backspaceKey){backspaceKey=false;return"Accidental pageback prevention:"}});$(document).off("keydown.hotkeys");$(document).on("keydown.hotkeys",function(event){if(!event.shiftKey&&!event.ctrlKey&&event.altKey){if(event.which===87&&$("#cinematoggle").length){$("#cinematoggle").click();event.preventDefault();return false}if(event.which===83){$("#messagebuffer").data("spoilertype",$("#messagebuffer").data("spoilertype")==="hover"?"click":"hover");$(".image-spoiler").each(function(){$(this).attr("src",$(this).data()["spoiler"]).attr("data-spoiled","false")});typeof window[CHANNEL.name].VirtualWhisper==="function"&&window[CHANNEL.name].VirtualWhisper(String().concat("[System] ","Your spoiler setting is now: ",$("#messagebuffer").data("spoilertype"),"."));event.preventDefault();return false}}if(!event.ctrlKey)return true;if(typeof event.target.selectionStart=="undefined"||event.target.selectionStart==null)return true;var tag={};tag.wrap=false;tag.braced=false;var success=true;if(event.shiftKey){switch(event.which){case 66:tag.code="blur";tag.wrap=true;tag.braced=true;break;case 83:tag.code="shake";tag.wrap=true;tag.braced=true;break;default:success=false}}else{switch(event.which){case 87:if($("#skinnytoggle").length){$("#skinnytoggle").click();event.preventDefault()}return false;case 83:tag.code="spoiler";tag.wrap=true;tag.braced=true;break;case 66:tag.code="**";tag.wrap=true;break;case 73:tag.code="__";tag.wrap=true;break;case 77:tag.code="flop";tag.wrap=true;tag.braced=true;break;case 70:tag.code="flip";tag.wrap=true;tag.braced=true;break;case 191:tag.code="tilt-forward";tag.wrap=true;tag.braced=true;break;case 220:tag.code="tilt-reverse";tag.wrap=true;tag.braced=true;break;case 192:tag.code="~~";tag.wrap=true;break;case 80:tag.code=".pic";break;default:success=false}}if(!success){return true}if(!$(event.target).is("#chatline")&&!$(event.target).is(".pm-input")){return true}var text=$(event.target).val();var start=event.target.selectionStart;var end=event.target.selectionEnd;var caret=text.length;var zero=start==end;var sell=end-start;if(tag.wrap&&tag.braced){text=text.slice(0,start)+"["+tag.code+"] "+text.slice(start,end)+" [/"+tag.code+"]"+text.slice(end)}else if(tag.wrap){text=text.slice(0,start)+tag.code+text.slice(start,end)+tag.code+text.slice(end)}else{text=text.slice(0,start)+text.slice(start,end)+tag.code+text.slice(end)}$(event.target).val(text);if(zero){caret=end+tag.code.length+function(){if(tag.braced)return 3;return 0}();event.target.setSelectionRange(caret,caret)}else{end=$(event.target).val().length-caret+sell+start;event.target.setSelectionRange(start,end)}return false});$("#messagebuffer").off("click.quickact");$("#messagebuffer").on("click.quickact","strong.username",function(e){var user=$(this).parent().parent().attr("class").match(/chat-msg-(\w+)/)[1];if(e.altKey&&e.shiftKey&&CLIENT.rank>2){if(userlist()[user]){if(CLIENT.rank>userlist()[user].rank){socket.emit("chatMsg",{msg:"/kick "+user+" Quick Kick"})}}}if(e.altKey){return}if(e.shiftKey){return}if(!e.ctrlKey){return}if(user){initPm(user).find(".panel-heading").click()}});$("#chatline").off("paste.enhanced");$("#chatline").on("paste.enhanced",function(ev){var text=(ev.originalEvent||ev).clipboardData.getData("text/plain");text=shiftKey&&/^https?:\/\/(?:\w+\.)*(?:\w+\.)(?:\w+)\/(?:\w+\/)*(?:[^ ]+)(?:png|gif|jpe?g)(?:[^ ]+)?$/.test(text)?text+".pic":text;var success=document.execCommand("insertText",false,text);if(success){ev.preventDefault()}if(escCode){$("#chatline").trigger(function(){var ev=jQuery.Event("keydown");ev.which=ev.keyCode=13;return ev}())}});