/*!
**|   CyTube DecTalk TTS Module
**|   Copyright Xaekai 2014 - 2016
**|   Version 2016.10.12.1000
**|
**|   TTS Server Provided Courtesy of Cyzon
**|
**@requires chatline
**@optional whispers
**@preserve
*/
"use strict";function decodeHtmlEntities(str){const chars={amp:38,quot:34,lt:60,gt:62,laquo:171,raquo:187,larr:8592,rarr:8594,ldquo:8220,rdquo:8221,lsaquo:8249,rsaquo:8250,lsquo:8216,rsquo:8217,acute:180,bdquo:8222,brkbar:166,brvbar:166,cedil:184,cent:162,clubs:9827,copy:169,curren:164,darr:8595,deg:176,diams:9830,die:168,divide:247,euro:8364,frac12:189,frac14:188,frac34:190,frasl:47,hearts:9829,hellip:133,hibar:175,iexcl:161,iquest:191,macr:175,mdash:151,micro:181,middot:183,nbsp:160,ndash:150,not:172,oline:8254,ordf:170,ordm:186,para:182,permil:8240,plusmn:177,pound:163,reg:174,sbquo:8218,sect:167,shy:173,spades:9824,sup1:185,sup2:178,sup3:179,szlig:223,times:215,trade:8482,uarr:8593,uml:168,yen:165,yuml:255,Aacute:193,aacute:225,Acirc:194,acirc:226,AElig:198,aelig:230,Agrave:192,agrave:224,Aring:197,aring:229,Atilde:195,atilde:227,Auml:196,auml:228,Ccedil:199,ccedil:231,Eacute:201,eacute:233,Ecirc:202,ecirc:234,Egrave:200,egrave:232,ETH:208,eth:240,Euml:203,euml:235,Iacute:205,iacute:237,Icirc:206,icirc:238,Igrave:204,igrave:236,Iuml:207,iuml:239,Ntilde:209,ntilde:241,Oacute:211,oacute:243,Ocirc:212,ocirc:244,Ograve:210,ograve:242,Oslash:216,oslash:248,Otilde:213,otilde:245,Ouml:214,ouml:246,THORN:222,thorn:254,Uacute:218,uacute:250,Ucirc:219,ucirc:251,Ugrave:217,ugrave:249,Uuml:220,uuml:252,Yacute:221,yacute:253,Alpha:913,alpha:945,Beta:914,beta:946,Gamma:915,gamma:947,Delta:916,delta:948,Epsilon:917,epsilon:949,Zeta:918,zeta:950,Eta:919,eta:951,Theta:920,theta:952,Iota:921,iota:953,Kappa:922,kappa:954,Lambda:923,lambda:955,Mu:924,mu:956,Nu:925,nu:957,Xi:926,xi:958,Omicron:927,omicron:959,Pi:928,pi:960,Rho:929,rho:961,Sigma:931,sigma:963,Tau:932,tau:964,Upsilon:933,upsilon:965,Phi:934,phi:966,Chi:935,chi:967,Psi:936,psi:968,Omega:937,omega:969,dagger:8224,Dagger:8225};return str.replace(/&#?(\w+);/g,function(match,dec){if(isNaN(dec)){if(chars[dec]!==undefined){dec=chars[dec]}}return String.fromCharCode(dec)})}(function(CyTube_JohnMadden){return CyTube_JohnMadden(window,document,window.jQuery,Callbacks)})(function(window,document,$,Callbacks,undefined){if(typeof Storage==="undefined"){console.error("[XaeTube: TTS]","localStorage not supported. Aborting load.");return}else if(!!!$("#chatline").data("advanced")){console.error("[XaeTube: TTS]","Chat Line module not loaded. Aborting load.");return}else{console.info("[XaeTube: TTS]","Loading Module.")}({toggle:false,server:"https://tts.cyzon.us/tts?text=",handleChatMsg:function(data){if(!this.toggle&&!$("#forcetts").length){return}var msg=data.msg.replace(/<img class="channel-emote" src=".*?" title=":(.{1,40}):"[^>]*>/g,"$1").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/<.*?>/g,"");new Audio(this.server+encodeURIComponent(decodeHtmlEntities(msg))).play()},start:function(){if(CLIENT.tts){return}else{CLIENT.tts=this}this.setupListener();this.setupCommand()},setupListener:function(){socket.on("chatMsg",CLIENT.tts.handleChatMsg.bind(this))},setupCommand:function(){$("#chatline").trigger("registerCommand",["tts",this.handleCommand.bind(this)])},handleCommand:function(message){var params=message.substring(1).replace(/tts ?/,"").trim();if(params===""){this.toggle=!this.toggle}$("#messagebuffer").trigger("whisper",`[System] Text-to-speech ${this.toggle?"activated":"deactivated"}.`)}}).start()});